<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vigenere</title>

    <link rel="shortcut icon"
        href="https://img.freepik.com/free-vector/web-developer-hands-using-tablet-pc-creating-program-code-development-software-programming-concept_48369-33861.jpg?w=826" />



    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- font awesome -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</head>

<body>
    <!-- toast -->
    <div aria-live="polite" aria-atomic="true" style="position: relative; z-index: 100;">
        <div id="toast-success" class="toast bg-success text-light" style="position: absolute; top: 8px; right: 8px;">
            <div class="toast-header">
                <!-- <img src="..." class="rounded mr-2" alt="..."> -->
                <strong class="mr-auto">Success</strong>
                <!-- <small>11 mins ago</small> -->
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                Success
            </div>
        </div>

        <div id="toast-faild" class="toast bg-danger text-light" style="position: absolute; top: 8px; right: 8px;">
            <div class="toast-header">
                <!-- <img src="..." class="rounded mr-2" alt="..."> -->
                <strong class="mr-auto">Faild</strong>
                <!-- <small>11 mins ago</small> -->
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body ">
                Điền chuỗi vào nè
            </div>
        </div>
    </div>

    <!-- main program -->
    <div class="container-fluid bg-secondary py-1">
        <div class="container-fluid ">

            <div class="row">

                <div class="col">

                    <div class="col-12">
                        <h1 class="text-center text-light">Vigenere</h1>
                    </div>

                    <div class="col-12">
                        <div class="input-group my-1">

                            <textarea autocomplete="off" id="input-text" type="text" class="form-control" maxlength="30"
                                placeholder="Input" aria-label="Input" aria-describedby="basic-addon1" cols="15"
                                style="text-transform: uppercase;"></textarea>

                        </div>
                    </div>

                    <!-- output -->
                    <div class="col-12">
                        <div class="input-group my-3">

                            <!-- <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">
                                    Output
                                </span>
                            </div> -->

                            <textarea autocomplete="off" disabled id="output-text" type="text" class="form-control"
                                placeholder="Output" aria-label="Output" aria-describedby="basic-addon1" cols="15"
                                style="text-transform: uppercase;"></textarea>

                        </div>
                    </div>

                    <!-- trash -->
                    <div class="col-12">
                        <h1 class="text-center text-light my-3">Method</h1>
                        <div id="toggler" class="btn-group btn-group-toggle" data-toggle="buttons">
                            <label class="btn btn-primary active">
                                <input type="radio" name="options" id="option1" checked> Repeat
                            </label>
                            <label class="btn btn-primary">
                                <input type="radio" name="options" id="option2"> AutoKey
                            </label>

                        </div>

                    </div>

                    <!-- history -->
                    <div class="col-12">
                        <h2 class="text-center text-light my-3">History</h2>
                        <ul id="history" class="list-group">
                            <!-- <li class="list-group-item">An item</li> -->
                        </ul>

                    </div>
                </div>

                <!-- table -->
                <div class="col-8">
                    <div id="alpha" class="row">

                    </div>
                </div>

                <div class="col">
                    <div class="row">


                        <!-- show char -->
                        <div id="box-char" class="col-12">
                            <h3 class="text-light">Step</h3>
                        </div>

                        <div class="col-12">
                            <h4 id="render-k" class="text-light">render Key
                            </h4>
                        </div>

                        <!-- value k -->
                        <div class="col-12 my-3">
                            <div class="input-group my-1">
                                <!-- <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">
                                        Giá trị k
                                    </span>
                                </div> -->
                                <input autocomplete="off" id="k" type="text" class="form-control" maxlength="30"
                                    placeholder="K ???" aria-label="K ???" aria-describedby="basic-addon1"
                                    style="text-transform: uppercase;">
                            </div>
                        </div>

                        <!-- button render -->
                        <div class="col-12">
                            <button id="render" type="button" class="btn btn-primary">Render</button>
                            <button id="stepbystep" type="button" class="btn btn-outline-primary text-light"
                                disabled>Next</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>









    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <!-- boostrap -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script>

        $(document).ready(function () {
            let indexOutput = 0;

            function render1() {
                let k = $('#k').val();
                let chuoi = $('#input-text').val();

                let i = 0;
                while (k.length < chuoi.length) {
                    k += k[i++];
                }

                console.log('method 1');
                console.log(k, 'k');
                console.log(chuoi, 'chuoi');
                return k;

            };

            function render2() {
                let k = $('#k').val();
                let chuoi = $('#input-text').val();

                let i = 0;
                while (k.length < chuoi.length) {
                    k += chuoi[i++];
                }

                console.log('method 2');
                console.log(k, 'k');
                console.log(chuoi, 'chuoi');
                return k;
            };

            // note dong khong cong
            // cot cong them2
            let btn = $('#render').click(function (event) {
                let chuoi = $('#input-text').val();
                let k = $('#k').val();

                // console.log(chuoi);
                // console.log(k);

                // store history 
                if ($('#output-text').val() !== '') {
                    console.log('hi');
                    $('#history').append(
                        `<li class="list-group-item">${$('#output-text').val()}</li>`
                    );
                }

                if (chuoi !== '' && k !== '' && chuoi.length >= k.length) {
                    $('#toast-success').toast({ delay: 1000 });
                    $('#toast-success').toast('show',);
                    renderTable();
                    if ($("#option1").is(":checked")) {
                        $('#render-k').text(render1().toUpperCase());
                    } else {
                        $('#render-k').text(render2().toUpperCase());
                        // $('#k').val(render2());
                    }
                    $('#render').attr('disabled', 'disabled');
                    $('#output-text').val('');
                    $('#stepbystep').removeAttr('disabled');


                } else {
                    $('#toast-faild').toast({ delay: 1000 });
                    $('#toast-faild').toast('show',);
                }



            });

            function renderTable() {
                let k = $('#k').val();
                let chuoi = $('#input-text').val().toUpperCase();

                $('#alpha').empty();
                let alpha = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
                let table = [];
                // $('#alpha').append(`<button class="col mx-1 btn btn-light btn-sm" disabled>${alpha[i]}</button>`);
                for (let i = 0; i < alpha.length; i++) {
                    table[i] = [];
                    for (let j = 0; j < alpha.length; j++) {
                        table[i][j] = alpha[(i + j) % 26];
                    }
                }

                // console.log(table);
                for (let i = -1; i < alpha.length; i++) {
                    $('#alpha').append(`<div id="alpha-${i}" class="row w-100 flex-nowrap d-flex justify-content-between"></div>`);
                    // $(`#alpha--1`).append(`<button class="col m-1 btn btn-light btn-sm" disabled>0</button>`);

                }


                $(`#alpha--1`).append(`<button class="col m-1 btn btn-light btn-sm" disabled>&times</button>`);
                // $(`#alpha--1`).append(`<div class="col m-1">0</div>`);
                for (let i = 0; i < alpha.length; i++) {
                    // $(`#alpha--1`).append(`<div class="col m-1">${alpha[i]}</div>`);
                    $(`#alpha--1`).append(`<button class="col m-1 btn btn-dark btn-sm" disabled>${alpha[i]}</button>`);

                }
                for (let i = 0; i < alpha.length; i++) {
                    // $('#alpha').append(`<div id="alpha-${i}" class="row w-100 flex-nowrap d-flex justify-content-between"></div>`);

                    // $(`#alpha-${i}`).append(`<div class="col m-1">${alpha[i]}</div>`);
                    $(`#alpha-${i}`).append(`<button class="col m-1 btn btn-dark btn-sm" disabled>${alpha[i]}</button>`);
                    for (let j = 0; j < alpha.length; j++) {
                        // $(`#alpha-${i}`).append(`<div class="col m-1">${table[i][j]}</div>`);
                        $(`#alpha-${i}`).append(`<button class="col m-1 btn btn-light btn-sm" disabled>${table[i][j]}</button>`);
                    }
                }


                // for (let i = 0; i < alpha.length; i++) {
                //     $('#render-alpha').append(`<button class="col mx-1 btn btn-light btn-sm" disabled>${alpha[(i + k) % 26]}</button>`);
                // }

                // if (chuoi != '') {
                //     let output = '';
                //     for (let i = 0; i < chuoi.length; i++) {
                //         output += alpha[(alpha.indexOf(chuoi[i]) + k) % 26];
                //         // console.log(chuoi[i], alpha.indexOf(chuoi[i]));
                //     }
                //     $('#output-text').val(output);
                //     // console.log(output);
                // } else {
                //     $('#output-text').val('');
                // }
            }

            $('#stepbystep').click(function () {
                let input = $('#input-text').val().toUpperCase();
                let output = $('#output-text').val().toUpperCase();
                let key = $('#render-k').text();

                console.log(key);

                if (input.length == output.length) {
                    $('#stepbystep').attr('disabled', 'disabled');
                    $('#render').removeAttr('disabled');
                    indexOutput = 0;
                } else {
                    if (output.length > input.length) {
                        $('#output-text').val('');
                        return;
                    }

                    // create table 
                    let alpha = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
                    let table = [];
                    // $('#alpha').append(`<button class="col mx-1 btn btn-light btn-sm" disabled>${alpha[i]}</button>`);
                    for (let i = 0; i < alpha.length; i++) {
                        table[i] = [];
                        for (let j = 0; j < alpha.length; j++) {
                            table[i][j] = alpha[(i + j) % 26];
                        }
                    }

                    console.log(table);

                    console.log('index', indexOutput);
                    if (indexOutput < input.length) {

                        // console.log('step by step', $('#output-text').val());
                        // console.log('step by step', input[indexOutput]);
                        // console.log('step by step', alpha.indexOf(input[indexOutput]));
                        // console.log('step by step', key[indexOutput]);
                        // console.log('step by step', alpha.indexOf(key[indexOutput]));
                        // console.log('step by step', table[alpha.indexOf(input[indexOutput])][alpha.indexOf(key[indexOutput])]);
                        let i = alpha.indexOf(key[indexOutput]);
                        let j = alpha.indexOf(input[indexOutput]);

                        $('#box-char').empty()
                            .append('<h3 class="text-light">Step</h3>')
                            .append(`<div class="col-12 text-light">i: ${indexOutput + 1}</div>`)
                            .append(`<div class="col-12 text-light">input = ${input[indexOutput]}</div>`)
                            .append(`<div class="col-12 text-light">key = ${key[indexOutput]}</div>`)

                        $('#output-text').val($('#output-text').val() + table[i][j]);
                        indexOutput += 1;

                        $(`#alpha-${i} button:nth-child(${j + 2})`).addClass('btn-warning');
                        $(`#alpha-${i} button:nth-child(${j + 2})`).removeClass('btn-light');

                    }

                }
            });


            $('#k').keydown(function () {
                $('#render').removeAttr('disabled');

            });

            $('#option1').change(function () {
                $('#render').removeAttr('disabled');
            });
            $('#option2').change(function () {
                $('#render').removeAttr('disabled');
            });

            // $('#k').change(function () {
            //     let k = $('#k').val();
            //     let chuoi = $('#input-text').val().toUpperCase();

            //     let alpha = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
            //     let table = [];
            //     // $('#alpha').append(`<button class="col mx-1 btn btn-light btn-sm" disabled>${alpha[i]}</button>`);
            //     for (let i = 0; i < alpha.length; i++) {
            //         table[i] = [];
            //         for (let j = 0; j < alpha.length; j++) {
            //             table[i][j] = alpha[(i + j) % 26];
            //         }
            //     }

            //     // console.log(table);
            //     for (let i = -1; i < alpha.length; i++) {
            //         $('#alpha').append(`<div id="alpha-${i}" class="row w-100 flex-nowrap d-flex justify-content-between"></div>`);
            //         // $(`#alpha--1`).append(`<button class="col m-1 btn btn-light btn-sm" disabled>0</button>`);

            //     }


            //     $(`#alpha--1`).append(`<button class="col m-1 btn btn-light btn-sm" disabled>&times</button>`);
            //     // $(`#alpha--1`).append(`<div class="col m-1">0</div>`);
            //     for (let i = 0; i < alpha.length; i++) {
            //         // $(`#alpha--1`).append(`<div class="col m-1">${alpha[i]}</div>`);
            //         $(`#alpha--1`).append(`<button class="col m-1 btn btn-dark btn-sm" disabled>${alpha[i]}</button>`);

            //     }
            //     for (let i = 0; i < alpha.length; i++) {
            //         // $('#alpha').append(`<div id="alpha-${i}" class="row w-100 flex-nowrap d-flex justify-content-between"></div>`);

            //         // $(`#alpha-${i}`).append(`<div class="col m-1">${alpha[i]}</div>`);
            //         $(`#alpha-${i}`).append(`<button class="col m-1 btn btn-dark btn-sm" disabled>${alpha[i]}</button>`);
            //         for (let j = 0; j < alpha.length; j++) {
            //             // $(`#alpha-${i}`).append(`<div class="col m-1">${table[i][j]}</div>`);
            //             $(`#alpha-${i}`).append(`<button class="col m-1 btn btn-light btn-sm" disabled>${table[i][j]}</button>`);
            //         }
            //     }


            //     // for (let i = 0; i < alpha.length; i++) {
            //     //     $('#render-alpha').append(`<button class="col mx-1 btn btn-light btn-sm" disabled>${alpha[(i + k) % 26]}</button>`);
            //     // }

            //     if (chuoi != '') {
            //         let output = '';
            //         for (let i = 0; i < chuoi.length; i++) {
            //             output += alpha[(alpha.indexOf(chuoi[i]) + k) % 26];
            //             // console.log(chuoi[i], alpha.indexOf(chuoi[i]));
            //         }
            //         $('#output-text').val(output);
            //         console.log(output);
            //     } else {
            //         $('#output-text').val('');
            //     }
            // });

            $('#input-text').on({
                keyup: function (e) {

                    let k = parseInt($('#k').val());
                    let chuoi = $('#input-text').val().toUpperCase();

                    let alpha = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

                    // let output = '';
                    // for (let i = 0; i < chuoi.length; i++) {
                    //     output += alpha[(alpha.indexOf(chuoi[i]) + k) % 26];
                    //     // console.log(chuoi[i], alpha.indexOf(chuoi[i]));
                    // }
                    // $('#output-text').val(output);
                    // console.log(output);
                }, change: function () {
                    this.value = this.value.replace(/\s/gm, "");
                }
                , keypress: function (e) {
                    let keyPass = [32, 39, 59, 58, 34, 44, 46, 60, 62, 45, 61, 91, 93, 47, 63, 49, 50, 51, 52, 53, 54, 55, 56, 57, 48];
                    console.log(e.which);
                    if (keyPass.includes(e.which)) {
                        return false;
                    }
                }
            }
            );

        });
    </script>
</body>

</html>